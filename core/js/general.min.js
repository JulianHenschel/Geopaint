var update_interval,timeout_interval,latest_marker_lat,latest_marker_long,record_coords,polyline_coords,polyline,allow_record=false,update_time=3E4;
$(function(){$("body").bind("turn",function(){setMapSize()});$("#size a").tap(function(){size=parseInt(this.innerHTML);$("#size_info2").html(size);document.getElementById("size_info1").style.width=size+"px";document.getElementById("size_info1").style.height=size+"px";document.getElementById("size_info1").style.mozBorderRadius=size/2+"px";document.getElementById("size_info1").style.webkitBorderRadius=size/2+"px";jQT.goBack()});$("#returnFromPainting").tap(function(){resetProject();jQT.goBack()});$("#saveColor").tap(function(){color=
document.getElementById("selectedcolor").value.replace("#","");document.getElementById("color_info").style.background="#"+color;jQT.goBack()});$("#createNewProject").tap(function(){createNewProject()});$("#getMoreProjects").tap(function(){moreProjects()})});function createNewProject(){var i=$("#pname").val(),g=$("#ppassword").val();if(g!="")g=md5(g);sendData(domain+"/core/ajax/createNewProject.php?pname="+i+"&ppassword="+g+"&location="+locationname,handleNewProject)}
function handleNewProject(){if(xhttp.readyState==4){project_id=xhttp.responseText;var i=$("#pname").val()==""?project_id:$("#pname").val();$("#project_name").html(i);loadMap();jQT.goTo("#paint","slide")}}
function editExistingProject(i){project_id=i;if(document.getElementById("pname").value=="")document.getElementById("project_name").innerHTML=project_id;else document.getElementById("project_name").innerHTML=document.getElementById("pname").value;loadMap();timeout_interval=window.setTimeout("sendData(domain+'/core/ajax/getDrawing.php?id='+project_id, handleGetDrawing)",5E3);jQT.goTo("#paint","slide")}
function saveNewGeoPoint(){if(latest_marker_lat!=geodata.latitude&&latest_marker_long!=geodata.longitude&&project_id!=0&&allow_record){current_pos_marker&&current_pos_marker.setMap(null);var i=new google.maps.LatLng(geodata.latitude,geodata.longitude);current_pos_marker=new google.maps.Marker({position:i,map:map});sendData(domain+"/core/ajax/saveNewGeoPoint.php?latitude="+geodata.latitude+"&longitude="+geodata.longitude+"&altitude="+geodata.altitude+"&accuracy="+geodata.accuracy+"&heading="+geodata.heading+
"&speed="+geodata.speed+"&color="+color+"&size="+size+"&id="+project_id,handleGetDrawing);latest_marker_lat=geodata.latitude;latest_marker_long=geodata.longitude}if(document.getElementById("geo_accuracy"))document.getElementById("geo_accuracy").innerHTML=geodata.accuracy;if(document.getElementById("geo_counter"))document.getElementById("geo_counter").innerHTML=parseFloat(document.getElementById("geo_counter").innerHTML)+1}
function handleGetDrawing(){if(xhttp.readyState==4){var i=xhttp.responseText;if(i!=""){removePolyline();removeMarkers();i=i.split(";");for(var g=[],h=0,j=0,k=0;k<i.length;k++){var l=i[k].split(",");if(h!=l[2]){g[j]=[];g[j].push(l);h=l[2];j++}else g[j-1].push(l)}for(h=0;h<g.length;h++){j=[];for(k=0;k<g[h].length;k++)j.push(g[h][k].join(","));drawPolylines(j.join(";"))}i=unique(i);for(g=0;g<i.length;g++){h=i[g].split(",");new google.maps.LatLng(h[0],h[1]);setMarker(h[0],h[1])}}$("#sliding_image").fadeOut("slow")}}
function drawPolylines(i){var g=[];i=i.split(";");for(var h=0;h<i.length;h++){var j=i[h].split(",");if(j.length>1){g[h]=[];g[h].push(j)}}for(h=0;h<g.length;h++)if(g.length>1){i=new google.maps.MVCArray;if(h>0){j=new google.maps.LatLng(g[h][0][0],g[h][0][1]);var k=new google.maps.LatLng(g[h-1][0][0],g[h-1][0][1]);i.insertAt(i.length,k);i.insertAt(i.length,j);setPolyline(i,g[h][0][4],1,"#"+g[h][0][3])}}}
function recordStatus(){record_coords=document.getElementById("record").checked;if(record_coords==true)return allow_record?true:sendData(domain+"/core/ajax/getPassword.php?id="+project_id,handlePassword);else{sendData(domain+"/core/ajax/regenerateId.php");return false}}
function handlePassword(){if(xhttp.readyState==4)if(xhttp.responseText!="open")if(md5(prompt("Passwort:",""))!=xhttp.responseText){alert("Falsches Passwort");return document.getElementById("record").checked=false}else{allow_record=true;saveNewGeoPoint();update_interval=window.setInterval("saveNewGeoPoint()",update_time);return true}else if(xhttp.responseText=="open"){allow_record=true;saveNewGeoPoint();update_interval=window.setInterval("saveNewGeoPoint()",update_time);return true}}
function resetProject(){removePolyline();removeMarkers();current_pos_marker&&current_pos_marker.setMap(null);document.getElementById("pname").value="";document.getElementById("ppassword").value="";document.getElementById("project_name").value="";window.clearInterval(update_interval);window.clearTimeout(timeout_interval);allow_record=false;document.getElementById("record").checked=false;latest_marker_long=latest_marker_lat="";project_id=0}
function deleteProject(){var i=prompt("Passwort:","");i!=""&&sendData(domain+"/core/ajax/deleteProject.php?id="+project_id+"&pwd="+md5(i),handledeleteProject)}function handledeleteProject(){if(xhttp.readyState==4)if(xhttp.responseText=="true"){resetProject();jQT.goTo("#starting_options")}else alert("Falsches Passwort")}function unique(i){var g=[],h=0;a:for(;h<i.length;h++){for(var j=0;j<g.length;j++)if(g[j]==i[h])continue a;g[g.length]=i[h]}return g}
function md5(i){var g=function(m,n){var p,r,s,q,o;s=m&2147483648;q=n&2147483648;p=m&1073741824;r=n&1073741824;o=(m&1073741823)+(n&1073741823);if(p&r)return o^2147483648^s^q;return p|r?o&1073741824?o^3221225472^s^q:o^1073741824^s^q:o^s^q},h=function(m,n,p,r,s,q,o){m=g(m,g(g(n&p|~n&r,s),o));return g(m<<q|m>>>32-q,n)},j=function(m,n,p,r,s,q,o){m=g(m,g(g(n&r|p&~r,s),o));return g(m<<q|m>>>32-q,n)},k=function(m,n,p,r,s,q,o){m=g(m,g(g(n^p^r,s),o));return g(m<<q|m>>>32-q,n)},l=function(m,n,p,r,s,q,o){m=g(m,
g(g(p^(n|~r),s),o));return g(m<<q|m>>>32-q,n)},t=function(m){var n="",p="",r;for(r=0;r<=3;r++){p=m>>>r*8&255;p="0"+p.toString(16);n+=p.substr(p.length-2,2)}return n},e=[],f,u,v,w,x,a,b,c,d;i=this.utf8_encode(i);e=function(m){var n,p=m.length;n=p+8;for(var r=((n-n%64)/64+1)*16,s=Array(r-1),q=0,o=0;o<p;){n=(o-o%4)/4;q=o%4*8;s[n]|=m.charCodeAt(o)<<q;o++}n=(o-o%4)/4;q=o%4*8;s[n]|=128<<q;s[r-2]=p<<3;s[r-1]=p>>>29;return s}(i);a=1732584193;b=4023233417;c=2562383102;d=271733878;i=e.length;for(f=0;f<i;f+=
16){u=a;v=b;w=c;x=d;a=h(a,b,c,d,e[f+0],7,3614090360);d=h(d,a,b,c,e[f+1],12,3905402710);c=h(c,d,a,b,e[f+2],17,606105819);b=h(b,c,d,a,e[f+3],22,3250441966);a=h(a,b,c,d,e[f+4],7,4118548399);d=h(d,a,b,c,e[f+5],12,1200080426);c=h(c,d,a,b,e[f+6],17,2821735955);b=h(b,c,d,a,e[f+7],22,4249261313);a=h(a,b,c,d,e[f+8],7,1770035416);d=h(d,a,b,c,e[f+9],12,2336552879);c=h(c,d,a,b,e[f+10],17,4294925233);b=h(b,c,d,a,e[f+11],22,2304563134);a=h(a,b,c,d,e[f+12],7,1804603682);d=h(d,a,b,c,e[f+13],12,4254626195);c=h(c,
d,a,b,e[f+14],17,2792965006);b=h(b,c,d,a,e[f+15],22,1236535329);a=j(a,b,c,d,e[f+1],5,4129170786);d=j(d,a,b,c,e[f+6],9,3225465664);c=j(c,d,a,b,e[f+11],14,643717713);b=j(b,c,d,a,e[f+0],20,3921069994);a=j(a,b,c,d,e[f+5],5,3593408605);d=j(d,a,b,c,e[f+10],9,38016083);c=j(c,d,a,b,e[f+15],14,3634488961);b=j(b,c,d,a,e[f+4],20,3889429448);a=j(a,b,c,d,e[f+9],5,568446438);d=j(d,a,b,c,e[f+14],9,3275163606);c=j(c,d,a,b,e[f+3],14,4107603335);b=j(b,c,d,a,e[f+8],20,1163531501);a=j(a,b,c,d,e[f+13],5,2850285829);d=
j(d,a,b,c,e[f+2],9,4243563512);c=j(c,d,a,b,e[f+7],14,1735328473);b=j(b,c,d,a,e[f+12],20,2368359562);a=k(a,b,c,d,e[f+5],4,4294588738);d=k(d,a,b,c,e[f+8],11,2272392833);c=k(c,d,a,b,e[f+11],16,1839030562);b=k(b,c,d,a,e[f+14],23,4259657740);a=k(a,b,c,d,e[f+1],4,2763975236);d=k(d,a,b,c,e[f+4],11,1272893353);c=k(c,d,a,b,e[f+7],16,4139469664);b=k(b,c,d,a,e[f+10],23,3200236656);a=k(a,b,c,d,e[f+13],4,681279174);d=k(d,a,b,c,e[f+0],11,3936430074);c=k(c,d,a,b,e[f+3],16,3572445317);b=k(b,c,d,a,e[f+6],23,76029189);
a=k(a,b,c,d,e[f+9],4,3654602809);d=k(d,a,b,c,e[f+12],11,3873151461);c=k(c,d,a,b,e[f+15],16,530742520);b=k(b,c,d,a,e[f+2],23,3299628645);a=l(a,b,c,d,e[f+0],6,4096336452);d=l(d,a,b,c,e[f+7],10,1126891415);c=l(c,d,a,b,e[f+14],15,2878612391);b=l(b,c,d,a,e[f+5],21,4237533241);a=l(a,b,c,d,e[f+12],6,1700485571);d=l(d,a,b,c,e[f+3],10,2399980690);c=l(c,d,a,b,e[f+10],15,4293915773);b=l(b,c,d,a,e[f+1],21,2240044497);a=l(a,b,c,d,e[f+8],6,1873313359);d=l(d,a,b,c,e[f+15],10,4264355552);c=l(c,d,a,b,e[f+6],15,2734768916);
b=l(b,c,d,a,e[f+13],21,1309151649);a=l(a,b,c,d,e[f+4],6,4149444226);d=l(d,a,b,c,e[f+11],10,3174756917);c=l(c,d,a,b,e[f+2],15,718787259);b=l(b,c,d,a,e[f+9],21,3951481745);a=g(a,u);b=g(b,v);c=g(c,w);d=g(d,x)}return(t(a)+t(b)+t(c)+t(d)).toLowerCase()}
function utf8_encode(i){i=i+"";var g="",h,j,k=0;h=j=0;k=i.length;for(var l=0;l<k;l++){var t=i.charCodeAt(l),e=null;if(t<128)j++;else e=t>127&&t<2048?String.fromCharCode(t>>6|192)+String.fromCharCode(t&63|128):String.fromCharCode(t>>12|224)+String.fromCharCode(t>>6&63|128)+String.fromCharCode(t&63|128);if(e!==null){if(j>h)g+=i.substring(h,j);g+=e;h=j=l+1}}if(j>h)g+=i.substring(h,i.length);return g}
function dump(i,g){var h="";g||(g=0);for(var j="",k=0;k<g+1;k++)j+="    ";if(typeof i=="object")for(var l in i){k=i[l];if(typeof k=="object"){h+=j+"'"+l+"' ...\n";h+=dump(k,g+1)}else h+=j+"'"+l+"' => \""+k+'"\n'}else h="===>"+i+"<===("+typeof i+")";return h};